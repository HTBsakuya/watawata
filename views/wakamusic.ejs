<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>わかめ🎶 - <%= query %></title>
    <link rel="stylesheet" href="/css/wakamusic.css">
    <link rel="stylesheet" href="/css/slide.css">
</head>
<body>

<header>
    <div class="search-container">
        <form action="/wakamc" method="get">
            <input type="text" name="q" placeholder="曲を探す" required value="<%= query %>">
            <button type="submit">🔍</button>
        </form>
    </div>
    <p>
      &copy; わかめ02 / 2024
  </p>
    <button id="action-btn">
        <img src="https://cdn.glitch.global/441c91ae-2a7f-4142-9ffb-ab0c7066dfa1/IMG_1281.png?v=1718682861752" alt="User" width="50px" />
    </div>
</header>

<nav id="side-menu" class="side-menu">
    <ul>
        <li><a href="/famous">曲を聴く(旧サイト)</a></li>
        <li><a href="/blog/up" target="_blank">アップデートを確認</a></li>
    </ul>
</nav>
<div id="overlay" class="overlay"></div>

<main>
    <% if (tracks && tracks.length > 0) { %>
        <ul>
            <% tracks.forEach(track => { %>
                <li>
                    <img src="<%= track.artwork_url %>" alt="Artwork">
                    <div class="track-info">
                        <p class="track-title"><%= track.title %></p>
                        <p class="track-artist">by <%= track.username %></p>
                    </div>
                    <button class="play-btn" data-track-id="<%= track.id %>">Play</button>
                </li>
            <% }) %>
        </ul>
    <% } else { %>
        <p>上のやつで検索してみよう。</p>
    <% } %>
</main>

<div class="player-bar" id="player-bar">
    <iframe id="sc-player" scrolling="no" frameborder="no"></iframe>
</div>

<script>
    document.querySelectorAll('.play-btn').forEach(element => {
        element.addEventListener('click', function(e) {
            e.preventDefault();
            const trackId = e.target.getAttribute('data-track-id');
            playTrack(trackId);
        });
    });

    function playTrack(trackId) {
        const playerBar = document.getElementById('player-bar');
        const player = document.getElementById('sc-player');

        player.src = `https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/${trackId}&color=%23ff5500&auto_play=true`;

        playerBar.style.display = 'flex';
    }
  
const menuBtn = document.getElementById('action-btn');
const sideMenu = document.getElementById('side-menu');
const overlay = document.getElementById('overlay');

function toggleMenu() {
    sideMenu.classList.toggle('open');
    overlay.classList.toggle('active');
}

menuBtn.addEventListener('click', toggleMenu);

overlay.addEventListener('click', toggleMenu);
  
function addToFavorites(artwork_url, title, id) {
    let favorites = getFavoritesFromCookies();
    favorites.push({ artwork_url, title, id });

    document.cookie = `wakamemusicfavorites=${encodeURIComponent(JSON.stringify(favorites))}; path=/; max-age=31536000`;
    alert("お気に入りに追加しました！");
}

function getFavoritesFromCookies() {
    const favoritesCookie = document.cookie.split('; ').find(row => row.startsWith('wakamemusicfavorites='));
    if (favoritesCookie) {
        const cookieValue = favoritesCookie.split('=')[1];
        try {
            return JSON.parse(decodeURIComponent(cookieValue)); 
        } catch (error) {
            console.error('Error parsing favorites cookie:', error);
            return [];
        }
    }
    return [];
}

</script>

</body>
</html>
