<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お気に入り</title>
    <link rel="stylesheet" href="/css/wakamusic.css">
</head>
<body>
    <h1>お気に入りの曲</h1>
    
    <% if (tracks.length > 0) { %>
 <ul class="track-list">
  <% tracks.forEach(track => { %>
    <li class="track-item">
      <img src="<%= track.artwork_url %>" alt="Artwork" class="track-artwork">
      <div class="track-info">
        <h3><%= track.title %></h3>
        <button class="play-btn" onclick="playTrack('<%= track.stream_url %>')">Play</button>
      </div>
    </li>
  <% }); %>
</ul>
    <% } else { %>
        <p>お気に入りに登録された曲はありません。</p>
    <% } %>

<script>
    document.querySelectorAll('.play-btn').forEach(element => {
        element.addEventListener('click', function(e) {
            e.preventDefault();
            const trackId = e.target.getAttribute('data-track-id');
            playTrack(trackId);
        });
    });

    function playTrack(trackId) {
        const playerBar = document.getElementById('player-bar');
        const player = document.getElementById('sc-player');

        player.src = `https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/${trackId}&color=%23ff5500&auto_play=true`;

        playerBar.style.display = 'flex';
    }
  
const menuBtn = document.getElementById('action-btn');
const sideMenu = document.getElementById('side-menu');
const overlay = document.getElementById('overlay');

function toggleMenu() {
    sideMenu.classList.toggle('open');
    overlay.classList.toggle('active');
}

menuBtn.addEventListener('click', toggleMenu);

overlay.addEventListener('click', toggleMenu);
  
function addToFavorites(artworkUrl, title, trackId) {
    const favoritesCookie = getCookie('wakamemusicfavorites');
    let favorites = favoritesCookie ? JSON.parse(wakamemusicfavorites) : [];

    const favoriteTrack = {
        artwork_url: artworkUrl,
        title: title,
        id: trackId
    };

    const isAlreadyFavorite = favorites.some(track => track.id === trackId);
    if (!isAlreadyFavorite) {
        favorites.push(favoriteTrack);
    }

    document.cookie = `wakamemusicfavorites=${JSON.stringify(favorites)};path=/`;

    alert("お気に入りに追加しました！");
}

function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
}

</script>
</body>
</html>
